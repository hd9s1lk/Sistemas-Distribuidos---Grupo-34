<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Tabela WAVY</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #111;
            margin: 0;
            padding: 0;
        }
        h2 {
            text-align: center;
            color: #ff1744;
            margin-top: 32px;
        }
        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 90%;
            margin: 32px auto;
            background: #000;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(30,30,30,0.5);
            overflow: hidden;
        }
        th, td {
            padding: 12px 8px;
            text-align: center;
        }
        th {
            background: linear-gradient(90deg, #b71c1c 0%, #d32f2f 100%);
            color: #fff;
            font-size: 1.08em;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #d32f2f;
        }
        tr {
            transition: background 0.2s;
        }
        tr:nth-child(even) {
            background: #222;
        }
        tr:hover {
            background: #ff5252;
        }
        td {
            font-size: 1em;
            color: #f5f5f5;
            border-bottom: 1px solid #444;
        }
        .custom-dropdown {
            position: relative;
            min-width: 125px;
            max-width: 190px;
            font-size: 14px;
            font-family: inherit;
            user-select: none;
        }
        .custom-selected {
            background: #000;
            color: #fff;
            border: 1.5px solid #ff1744;
            border-radius: 6px;
            padding: 6px 24px 6px 12px;
            cursor: pointer;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: border 0.2s, box-shadow 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
        }
        .custom-selected.open, .custom-selected:focus {
            border: 2px solid #ff5252;
            box-shadow: 0 0 0 2px #ff174455;
            background: #1a0005;
        }
        .custom-options {
            position: absolute;
            top: 110%;
            left: 0;
            right: 0;
            background: #000;
            border: 1.5px solid #ff1744;
            border-radius: 0 0 8px 8px;
            z-index: 10;
            box-shadow: 0 4px 16px #000a;
            max-height: 220px;
            overflow-y: auto;
            min-width: 170px;
            max-width: 260px;
        }
        .custom-options div {
            padding: 10px 16px;
            cursor: pointer;
            color: #fff;
            background: #000;
            transition: background 0.15s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .custom-options div:hover {
            background: #ff1744;
            color: #fff;
        }
        .custom-options .selected {
            background: #232323;
            color: #fff;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 900px) {
            table { font-size: 0.95em; }
            th, td { padding: 8px 4px; }
        }
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { display: none; }
            tr { margin-bottom: 16px; box-shadow: 0 2px 8px rgba(30,30,30,0.5); border-radius: 8px; }
            td { text-align: right; padding-left: 50%; position: relative; }
            td:before {
                position: absolute;
                left: 12px;
                top: 12px;
                white-space: nowrap;
                font-weight: bold;
                color: #ff1744;
                content: attr(data-label);
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div style="width:100%;text-align:center;margin-top:18px;margin-bottom:-3px;">
        <span style="font-size:1.1em;color:#494949;font-weight:700;display:inline-block;margin-bottom:0;">&lt; Sistemas Distribuídos &gt;</span>
    </div>
    <h2 style="margin-top:2px;">Tabela de Dados WAVY</h2>
    <div style="width:90%;margin:0 auto 16px auto;text-align:right;display:flex;gap:16px;justify-content:flex-end;align-items:center;">
        <span onclick="resetFiltros()" title="Resetar filtros" style="display:flex;width:18px;height:18px;background:#ffeb3c;border-radius:50%;margin-right:4px;cursor:pointer;box-shadow:0 1px 4px #0007;vertical-align:middle;transition:background 0.2s;align-items:center;justify-content:center;font-weight:400;font-family:'Segoe UI', Arial, sans-serif;font-size:12px;color:#000000;user-select:none;letter-spacing:0px;line-height:18px;">
            <span style="display:block;width:100%;text-align:center;line-height:1;">R</span>
        </span>
        <label for="tipoFiltro" style="font-weight:bold;color:#ff1744;">Filtragem por:</label>
        <div class="custom-dropdown" id="dropdown-tipoFiltro">
            <div class="custom-selected" onclick="toggleDropdown('tipoFiltro')" id="selected-tipoFiltro">Escolha...</div>
            <div class="custom-options" id="options-tipoFiltro" style="display:none;">
                <div data-value="" style="color:#000000;pointer-events:auto;">ㅤㅤㅤㅤ</div>
                <div data-value="2">WavyProcessamento</div>
                <div data-value="8">Estado</div>
            </div>
        </div>
        <div class="custom-dropdown" id="dropdown-valorFiltro" style="display:none;">
            <div class="custom-selected" onclick="toggleDropdown('valorFiltro')" id="selected-valorFiltro">Todos</div>
            <div class="custom-options" id="options-valorFiltro" style="display:none;"></div>
        </div>
    </div>
    <table id="tabelaWavy">
        <thead>
            <tr>
                <th onclick="ordenarTabela(0)" style="cursor:pointer; user-select:none;">ID <span id="seta-0"></span></th>
                <th onclick="ordenarTabela(1)" style="cursor:pointer; user-select:none;">IPWavy <span id="seta-1"></span></th>
                <th onclick="ordenarTabela(2)" style="cursor:pointer; user-select:none;">WavyProcessamento <span id="seta-2"></span></th>
                <th onclick="ordenarTabela(3)" style="cursor:pointer; user-select:none;">Temperatura <span id="seta-3"></span></th>
                <th onclick="ordenarTabela(4)" style="cursor:pointer; user-select:none;">Velocidade_Ondas <span id="seta-4"></span></th>
                <th onclick="ordenarTabela(5)" style="cursor:pointer; user-select:none;">Altura_Ondas <span id="seta-5"></span></th>
                <th onclick="ordenarTabela(6)" style="cursor:pointer; user-select:none;">Profundidade <span id="seta-6"></span></th>
                <th onclick="ordenarTabela(7)" style="cursor:pointer; user-select:none;">Data_dados <span id="seta-7"></span></th>
                <th onclick="ordenarTabela(8)" style="cursor:pointer; user-select:none;">Estado <span id="seta-8"></span></th>
            </tr>
        </thead>
        <tbody>
            {% for linha in dados %}
            <tr>
                {% for i in range(colunas|length) %}
                    <td data-label="{{ colunas[i] }}">{{ linha[i] }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
    let ordemAtual = {col: null, asc: true};
    function isDate(str) {
        return /^\d{1,2}[\/\-]\d{4}$/.test(str) || /^\d{4}-\d{1,2}-\d{1,2}$/.test(str);
    }
    function parseDate(str) {
        if (/^\d{1,2}[\/\-]\d{4}$/.test(str)) {
            let parts = str.split(/[\/\-]/);
            let day = parseInt(parts[0], 10);
            let month = parseInt(parts[1], 10) - 1;
            let year = parseInt(parts[2], 10);
            let d = new Date(year, month, day);
            if (d && d.getFullYear() === year && d.getMonth() === month && d.getDate() === day) {
                return d.getTime();
            }
        } else if (/^\d{4}-\d{1,2}-\d{1,2}$/.test(str)) {
            let parts = str.split('-');
            let year = parseInt(parts[0], 10);
            let month = parseInt(parts[1], 10) - 1;
            let day = parseInt(parts[2], 10);
            let d = new Date(year, month, day);
            if (d && d.getFullYear() === year && d.getMonth() === month && d.getDate() === day) {
                return d.getTime();
            }
        }
        return NaN;
    }
    function comparar(a, b, col, asc) {
        let valA = a.cells[col].innerText.trim();
        let valB = b.cells[col].innerText.trim();
        if (isDate(valA) && isDate(valB)) {
            let dA = parseDate(valA);
            let dB = parseDate(valB);
            if (!isNaN(dA) && !isNaN(dB)) {
                return asc ? dA - dB : dB - dA;
            }
        }
        let numA = parseFloat(valA.replace(',', '.'));
        let numB = parseFloat(valB.replace(',', '.'));
        if (!isNaN(numA) && !isNaN(numB)) {
            return asc ? numA - numB : numB - numA;
        } else {
            return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
    }
    function ordenarTabela(col) {
        let tabela = document.getElementById('tabelaWavy');
        let tbody = tabela.tBodies[0];
        let linhas = Array.from(tbody.rows);
        let asc = ordemAtual.col === col ? !ordemAtual.asc : true;
        linhas.sort((a, b) => comparar(a, b, col, asc));
        linhas.forEach(l => tbody.appendChild(l));
        for (let i = 0; i < tabela.tHead.rows[0].cells.length; i++) {
            document.getElementById('seta-' + i).innerText = '';
        }
        document.getElementById('seta-' + col).innerText = asc ? '▲' : '▼';
        ordemAtual = {col, asc};
    }
    // Filtro dinâmico para WavyProcessamento e Estado
    function atualizarValoresFiltro() {
        let tipo = document.getElementById('tipoFiltro').value;
        let valorFiltro = document.getElementById('valorFiltro');
        valorFiltro.innerHTML = '';
        valorFiltro.style.display = 'none';
        if (!tipo) { filtrarTabela(); return; }
        let tabela = document.getElementById('tabelaWavy');
        let linhas = Array.from(tabela.tBodies[0].rows);
        let valores = new Set();
        linhas.forEach(l => valores.add(l.cells[tipo].innerText.trim()));
        let arr = Array.from(valores).sort();
        valorFiltro.innerHTML = '<option value="">Todos</option>' + arr.map(v => `<option value="${v}">${v}</option>`).join('');
        valorFiltro.style.display = '';
        filtrarTabela();
    }
    // Custom dropdown logic
    let filtroTipo = '';
    let filtroValor = '';
    function toggleDropdown(tipo) {
        closeAllDropdowns(tipo);
        const selected = document.getElementById('selected-' + tipo);
        const options = document.getElementById('options-' + tipo);
        if (options.style.display === 'block') {
            options.style.display = 'none';
            selected.classList.remove('open');
        } else {
            options.style.display = 'block';
            selected.classList.add('open');
        }
    }
    function closeAllDropdowns(except) {
        ['tipoFiltro','valorFiltro'].forEach(function(tipo) {
            if (except !== tipo) {
                document.getElementById('options-' + tipo).style.display = 'none';
                document.getElementById('selected-' + tipo).classList.remove('open');
            }
        });
    }
    document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('custom-selected')) {
            closeAllDropdowns();
        }
    });
    // TipoFiltro
    document.querySelectorAll('#options-tipoFiltro div').forEach(function(opt) {
        opt.onclick = function() {
            filtroTipo = this.getAttribute('data-value');
            if (filtroTipo === "") {
                document.getElementById('selected-tipoFiltro').textContent = "Escolha...";
                document.getElementById('dropdown-valorFiltro').style.display = 'none';
                filtrarTabelaCustom();
            } else {
                document.getElementById('selected-tipoFiltro').textContent = this.textContent;
            }
            document.getElementById('options-tipoFiltro').style.display = 'none';
            document.getElementById('selected-tipoFiltro').classList.remove('open');
            if (filtroTipo !== "") atualizarValoresFiltroCustom();
        };
    });
    // ValorFiltro
    function atualizarValoresFiltroCustom() {
        filtroValor = '';
        let dropdown = document.getElementById('dropdown-valorFiltro');
        let selected = document.getElementById('selected-valorFiltro');
        let options = document.getElementById('options-valorFiltro');
        if (!filtroTipo) {
            dropdown.style.display = 'none';
            filtrarTabelaCustom();
            return;
        }
        let tabela = document.getElementById('tabelaWavy');
        let linhas = Array.from(tabela.tBodies[0].rows);
        let valores = new Set();
        linhas.forEach(l => valores.add(l.cells[filtroTipo].innerText.trim()));
        let arr = Array.from(valores).sort();
        options.innerHTML = '<div data-value="">Todos</div>' + arr.map(v => `<div data-value="${v}">${v}</div>`).join('');
        dropdown.style.display = '';
        selected.textContent = 'Todos';
        // Add click events
        options.querySelectorAll('div').forEach(function(opt) {
            opt.onclick = function() {
                filtroValor = this.getAttribute('data-value');
                selected.textContent = this.textContent;
                options.style.display = 'none';
                selected.classList.remove('open');
                filtrarTabelaCustom();
            };
        });
    }
    function filtrarTabelaCustom() {
        let tabela = document.getElementById('tabelaWavy');
        let linhas = Array.from(tabela.tBodies[0].rows);
        linhas.forEach(l => {
            if (!filtroTipo || !filtroValor) {
                l.style.display = '';
            } else {
                l.style.display = (l.cells[filtroTipo].innerText.trim() === filtroValor) ? '' : 'none';
            }
        });
    }
    // Salvar o HTML original do tbody na primeira execução
    if (!window.tbodyOriginalHTML) {
        window.tbodyOriginalHTML = document.querySelector('#tabelaWavy tbody').innerHTML;
    }
    function resetFiltros() {
        filtroTipo = '';
        filtroValor = '';
        document.getElementById('selected-tipoFiltro').textContent = 'Escolha...';
        document.getElementById('selected-tipoFiltro').classList.remove('open');
        document.getElementById('dropdown-valorFiltro').style.display = 'none';
        // Resetar ordenação: remover setas e restaurar ordem original
        let tabela = document.getElementById('tabelaWavy');
        let tbody = tabela.tBodies[0];
        // Restaurar tbody para o HTML original
        tbody.innerHTML = window.tbodyOriginalHTML;
        // Remover setas
        for (let i = 0; i < tabela.tHead.rows[0].cells.length; i++) {
            document.getElementById('seta-' + i).innerText = '';
        }
        ordemAtual = {col: null, asc: true};
        // Reaplicar listeners de ordenação
        for (let i = 0; i < tabela.tHead.rows[0].cells.length; i++) {
            tabela.tHead.rows[0].cells[i].onclick = function() { ordenarTabela(i); };
        }
        // Reaplicar filtro se necessário
        filtrarTabelaCustom();
    }
    </script>
</body>
</html>
